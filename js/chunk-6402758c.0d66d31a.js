(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6402758c"],{"8c58":function(e,t,o){"use strict";o.r(t);var a=o("7a23");const c=Object(a["createElementVNode"])("i",{class:"far fa-plus"},null,-1),n=[c],l={class:"row"},s={class:"col-md-11 mx-auto"},d={class:"d-md-flex justify-content-between align-items-center mb-4"},i=Object(a["createElementVNode"])("h2",{class:"text-center fs-4 mb-0"},"優惠券管理",-1),r={class:"card shadow rounded-4"},b={class:"card-body"},m={class:"table-responsive"},p={class:"table table-hover align-middle"},u=Object(a["createElementVNode"])("thead",null,[Object(a["createElementVNode"])("tr",{class:"bg-white sticky-top"},[Object(a["createElementVNode"])("th",{width:"160"},"名稱"),Object(a["createElementVNode"])("th",{width:"160"},"折扣碼"),Object(a["createElementVNode"])("th",{width:"100"},"折扣百分比"),Object(a["createElementVNode"])("th",{width:"100"},"到期日"),Object(a["createElementVNode"])("th",{width:"80",class:"text-center"},"是否啟用"),Object(a["createElementVNode"])("th",{width:"150"})])],-1),h={class:"d-flex justify-content-center switch-container"},j=["id","checked","onUpdate:modelValue","onChange"],O=["for"],N={class:"text-end"},V={class:"btn-group"},g=["onClick"],E=Object(a["createElementVNode"])("i",{class:"fas fa-edit fa-fw"},null,-1),f=[E],w=["onClick"],v=Object(a["createElementVNode"])("i",{class:"fas fa-trash-alt fa-fw"},null,-1),x=[v];function y(e,t,o,c,E,v){const y=Object(a["resolveComponent"])("Loading"),k=Object(a["resolveComponent"])("CouponModal"),C=Object(a["resolveComponent"])("DelModal");return Object(a["openBlock"])(),Object(a["createElementBlock"])(a["Fragment"],null,[Object(a["createVNode"])(y,{active:E.isLoading,"z-index":1061,loader:"bars"},null,8,["active"]),Object(a["createElementVNode"])("button",{type:"button",class:"add-fixed rounded-circle shadow d-md-none",onClick:t[0]||(t[0]=e=>v.openModal("new"))},n),Object(a["createElementVNode"])("div",l,[Object(a["createElementVNode"])("div",s,[Object(a["createElementVNode"])("div",d,[i,Object(a["createElementVNode"])("button",{type:"button",class:"btn btn-secondary text-white d-none d-md-block",onClick:t[1]||(t[1]=e=>v.openModal("new"))}," 新增優惠券 ")]),Object(a["createElementVNode"])("div",r,[Object(a["createElementVNode"])("div",b,[Object(a["createElementVNode"])("div",m,[Object(a["createElementVNode"])("table",p,[u,Object(a["createElementVNode"])("tbody",null,[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(E.coupons,t=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("tr",{key:t.id},[Object(a["createElementVNode"])("td",null,Object(a["toDisplayString"])(t.title),1),Object(a["createElementVNode"])("td",null,Object(a["toDisplayString"])(t.code),1),Object(a["createElementVNode"])("td",null,Object(a["toDisplayString"])(t.percent)+"%",1),Object(a["createElementVNode"])("td",null,Object(a["toDisplayString"])(e.$toLocalDate(t.due_date-86400)),1),Object(a["createElementVNode"])("td",null,[Object(a["createElementVNode"])("div",h,[Object(a["withDirectives"])(Object(a["createElementVNode"])("input",{type:"checkbox",class:"scroll-input",id:t.id,checked:t.is_enabled,"true-value":1,"false-value":0,"onUpdate:modelValue":e=>t.is_enabled=e,onChange:e=>v.updateCoupon(!1,t)},null,40,j),[[a["vModelCheckbox"],t.is_enabled]]),Object(a["createElementVNode"])("label",{for:t.id,class:"scroll-label"},null,8,O)])]),Object(a["createElementVNode"])("td",N,[Object(a["createElementVNode"])("div",V,[Object(a["createElementVNode"])("button",{type:"button",class:"operate-btn btn btn-outline-secondary btn-sm",onClick:e=>v.openModal("edit",t)},f,8,g),Object(a["createElementVNode"])("button",{type:"button",class:"operate-btn btn btn-outline-danger btn-sm",onClick:e=>v.openModal("delete",t)},x,8,w)])])]))),128))])])])])])])]),Object(a["createVNode"])(k,{ref:"couponModal","is-new":E.isNew,"temp-coupon":E.tempCoupon,onEmitUpdate:v.updateCoupon},null,8,["is-new","temp-coupon","onEmitUpdate"]),Object(a["createVNode"])(C,{ref:"delModal",topic:"coupon",tempData:E.tempCoupon,onEmitChange:v.triggerLoading,onEmitGet:v.getCoupons},null,8,["tempData","onEmitChange","onEmitGet"])],64)}const k={class:"modal fade",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},C={class:"modal-dialog modal-dialog-scrollable"},D={class:"modal-content"},M={class:"modal-header bg-primary"},B={class:"modal-title text-white",id:"exampleModalLabel"},$=Object(a["createElementVNode"])("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),S={class:"modal-body"},T={class:"mb-3"},L=Object(a["createElementVNode"])("label",{for:"title",class:"form-label"},[Object(a["createTextVNode"])("標題"),Object(a["createElementVNode"])("span",{class:"text-danger"},"*")],-1),_={class:"mb-3"},U=Object(a["createElementVNode"])("label",{for:"content",class:"form-label"},[Object(a["createTextVNode"])("詳述"),Object(a["createElementVNode"])("span",{class:"text-danger"},"*")],-1),F={class:"mb-3"},A=Object(a["createElementVNode"])("label",{for:"code",class:"form-label"},[Object(a["createTextVNode"])("優惠碼"),Object(a["createElementVNode"])("span",{class:"text-danger"},"*")],-1),J={class:"mb-3"},G=Object(a["createElementVNode"])("label",{for:"date",class:"form-label"},[Object(a["createTextVNode"])("到期日"),Object(a["createElementVNode"])("span",{class:"text-danger"},"*")],-1),z={class:"mb-3"},I=Object(a["createElementVNode"])("label",{for:"percent",class:"form-label"},[Object(a["createTextVNode"])(" 折扣百分比"),Object(a["createElementVNode"])("span",{class:"text-danger"},"*")],-1),q={class:"modal-footer"},H={key:0,class:"form-check me-auto"},K=Object(a["createElementVNode"])("label",{for:"is_enabled",class:"form-check-label align-middle"}," 是否啟用 ",-1),P=Object(a["createElementVNode"])("button",{type:"button",class:"btn btn-outline-gray btn-sm","data-bs-dismiss":"modal"}," 取消 ",-1);function Q(e,t,o,c,n,l){return Object(a["openBlock"])(),Object(a["createElementBlock"])("div",k,[Object(a["createElementVNode"])("div",C,[Object(a["createElementVNode"])("div",D,[Object(a["createElementVNode"])("div",M,[Object(a["createElementVNode"])("h5",B,Object(a["toDisplayString"])(o.isNew?"新增優惠券":"編輯優惠券"),1),$]),Object(a["createElementVNode"])("div",S,[Object(a["createElementVNode"])("div",T,[L,Object(a["withDirectives"])(Object(a["createElementVNode"])("input",{type:"text",class:"form-control",id:"title",placeholder:"請輸入標題","onUpdate:modelValue":t[0]||(t[0]=e=>n.coupon.title=e)},null,512),[[a["vModelText"],n.coupon.title,void 0,{trim:!0}]])]),Object(a["createElementVNode"])("div",_,[U,Object(a["withDirectives"])(Object(a["createElementVNode"])("input",{type:"text",class:"form-control",id:"content",placeholder:"請輸入詳述","onUpdate:modelValue":t[1]||(t[1]=e=>n.coupon.content=e)},null,512),[[a["vModelText"],n.coupon.content,void 0,{trim:!0}]])]),Object(a["createElementVNode"])("div",F,[A,Object(a["withDirectives"])(Object(a["createElementVNode"])("input",{type:"text",class:"form-control",id:"code",placeholder:"請輸入優惠碼","onUpdate:modelValue":t[2]||(t[2]=e=>n.coupon.code=e)},null,512),[[a["vModelText"],n.coupon.code,void 0,{trim:!0}]])]),Object(a["createElementVNode"])("div",J,[G,Object(a["withDirectives"])(Object(a["createElementVNode"])("input",{type:"date",class:"form-control",id:"date","onUpdate:modelValue":t[3]||(t[3]=e=>n.dueDate=e)},null,512),[[a["vModelText"],n.dueDate]])]),Object(a["createElementVNode"])("div",z,[I,Object(a["withDirectives"])(Object(a["createElementVNode"])("input",{type:"number",class:"form-control",id:"percent",placeholder:"請輸入百分比",min:"0",max:"99","onUpdate:modelValue":t[4]||(t[4]=e=>n.coupon.percent=e)},null,512),[[a["vModelText"],n.coupon.percent,void 0,{number:!0}]])])]),Object(a["createElementVNode"])("div",q,[o.isNew?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",H,[Object(a["withDirectives"])(Object(a["createElementVNode"])("input",{class:"form-check-input",type:"checkbox",id:"is_enabled","true-value":1,"false-value":0,"onUpdate:modelValue":t[5]||(t[5]=e=>n.coupon.is_enabled=e)},null,512),[[a["vModelCheckbox"],n.coupon.is_enabled]]),K])):Object(a["createCommentVNode"])("",!0),P,Object(a["createElementVNode"])("button",{type:"button",class:"btn btn-primary btn-sm",onClick:t[6]||(t[6]=(...e)=>l.trigger&&l.trigger(...e))}," 確認 ")])])])],512)}var R=o("519a"),W={data(){return{modal:"",coupon:{},dueDate:""}},mixins:[R["a"]],props:{isNew:Boolean,tempCoupon:Object},emits:{"emit-update":(e,t)=>("boolean"!==typeof e?console.warn("emit-update 事件的第一個參數型別需為 boolean"):"object"!==typeof t&&console.warn("emit-update 事件的第二個參數型別需為 object"),"boolean"!==typeof e&&"object"!==t)},methods:{trigger(){let e=!0;if(!this.coupon.title||!this.coupon.content||!this.coupon.due_date||!this.coupon.code||""===this.coupon.percent){const t={success:!1,message:"所有欄位都要填寫"};this.$httpMsgState(t,this.isNew?"新增":"更新"),e=!1}if(this.coupon.percent>99){const t={success:!1,message:"折扣百分比不能高於 99"};this.$httpMsgState(t,this.isNew?"新增":"更新"),e=!1}if(this.coupon.percent<0){const t={success:!1,message:"折扣百分比不能低於 0"};this.$httpMsgState(t,this.isNew?"新增":"更新"),e=!1}e&&this.$emit("emit-update",this.isNew,this.coupon)}},watch:{tempCoupon(){this.coupon={...this.tempCoupon},this.isNew&&(this.coupon.is_enabled=0);const e=1e3*this.coupon.due_date-86400;this.dueDate=new Date(e).toISOString().split("T",1).join()},dueDate(){this.coupon.due_date=Math.floor(new Date(this.dueDate)/1e3+86400)}}},X=o("d959"),Y=o.n(X);const Z=Y()(W,[["render",Q]]);var ee=Z,te=o("ebbb"),oe=o("7168"),ae={name:"Coupons Management",inheritAttrs:!1,data(){return{coupons:[],pagination:{},tempCoupon:{},isNew:!0,isLoading:!0}},components:{CouponModal:ee,DelModal:te["a"]},methods:{async getCoupons(e=1){try{const t="https://vue3-course-api.hexschool.io/api/peihan/admin/coupons?page="+e,o=await Object(oe["$get"])(t),{success:a,coupons:c,pagination:n}=o.data;a&&(this.coupons=c,this.pagination=n),this.triggerLoading(!1)}catch(t){this.$swal.fire({icon:"error",title:t.message})}},updateCoupon(e,t){let o,a;this.triggerLoading(!0),e?(o="https://vue3-course-api.hexschool.io/api/peihan/admin/coupon",a="post"):(o="https://vue3-course-api.hexschool.io/api/peihan/admin/coupon/"+t.id,a="put"),this.axios[a](o,{data:t}).then(t=>{t.data.success?(this.$refs.couponModal.hideModal(),this.getCoupons()):this.triggerLoading(!1),this.$httpMsgState(t.data,e?"新增":"更新")}).catch(e=>{this.$swal.fire({icon:"error",title:e.message})})},openModal(e,t){switch(e){case"new":this.isNew=!0,this.tempCoupon={due_date:Math.floor(Date.now()/1e3)},this.$refs.couponModal.openModal();break;case"edit":this.isNew=!1,this.tempCoupon=JSON.parse(JSON.stringify(t)),this.$refs.couponModal.openModal();break;case"delete":this.tempCoupon={...t},this.$refs.delModal.openModal();break;default:break}},triggerLoading(e){this.isLoading=e}},async created(){await this.getCoupons()}};const ce=Y()(ae,[["render",y]]);t["default"]=ce},ebbb:function(e,t,o){"use strict";var a=o("7a23");const c={class:"modal fade",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},n={class:"modal-dialog modal-dialog-centered"},l={class:"modal-content"},s=Object(a["createElementVNode"])("div",{class:"modal-header bg-danger"},[Object(a["createElementVNode"])("h5",{class:"modal-title text-white",id:"exampleModalLabel"}," 刪除 "),Object(a["createElementVNode"])("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),d={class:"modal-body"},i={class:"fw-bold text-danger"},r=Object(a["createElementVNode"])("span",{class:"fw-bold text-danger"},"所有訂單",-1),b={class:"fw-bold text-danger"},m={class:"fw-bold text-danger"},p={class:"fw-bold text-danger"},u={class:"modal-footer"},h=Object(a["createElementVNode"])("button",{type:"button",class:"btn btn-outline-gray btn-sm","data-bs-dismiss":"modal"}," 關閉 ",-1);function j(e,t,o,j,O,N){return Object(a["openBlock"])(),Object(a["createElementBlock"])("div",c,[Object(a["createElementVNode"])("div",n,[Object(a["createElementVNode"])("div",l,[s,Object(a["createElementVNode"])("div",d,[Object(a["createTextVNode"])(" 確定要刪除 "),"product"===o.topic?(Object(a["openBlock"])(),Object(a["createElementBlock"])(a["Fragment"],{key:0},[Object(a["createElementVNode"])("span",i,Object(a["toDisplayString"])(o.tempData.title),1),Object(a["createTextVNode"])(" 商品嗎？ ")],64)):o.isAll?(Object(a["openBlock"])(),Object(a["createElementBlock"])(a["Fragment"],{key:1},[r,Object(a["createTextVNode"])(" ？ ")],64)):"order"===o.topic?(Object(a["openBlock"])(),Object(a["createElementBlock"])(a["Fragment"],{key:2},[Object(a["createElementVNode"])("span",b,"編號 "+Object(a["toDisplayString"])(o.tempData.id),1),Object(a["createTextVNode"])(" 訂單？ ")],64)):"article"===o.topic?(Object(a["openBlock"])(),Object(a["createElementBlock"])(a["Fragment"],{key:3},[Object(a["createElementVNode"])("span",m,Object(a["toDisplayString"])(o.tempData.title),1),Object(a["createTextVNode"])(" 文章嗎？ ")],64)):(Object(a["openBlock"])(),Object(a["createElementBlock"])(a["Fragment"],{key:4},[Object(a["createElementVNode"])("span",p,Object(a["toDisplayString"])(o.tempData.title),1),Object(a["createTextVNode"])(" 優惠券嗎？ ")],64)),Object(a["createTextVNode"])(" 刪除後無法恢復！ ")]),Object(a["createElementVNode"])("div",u,[h,Object(a["createElementVNode"])("button",{type:"button",class:"btn btn-danger btn-sm",onClick:t[0]||(t[0]=(...e)=>N.delData&&N.delData(...e))}," 確定 ")])])])],512)}var O=o("519a"),N=o("7168"),V={data(){return{modal:null}},mixins:[O["a"]],props:{tempData:Object,topic:String,isAll:Boolean},emits:{"emit-change":e=>("boolean"!==typeof e&&console.warn("emit-change 事件的參數型別需為 boolean"),"boolean"!==typeof e),"emit-get":()=>!0},methods:{async delData(){this.$emit("emit-change",!0),this.hideModal();try{const e="https://vue3-course-api.hexschool.io/api/peihan/admin/"+(this.isAll?"orders/all":`${this.topic}/${this.tempData.id}`),t=await Object(N["$delete"])(e),{success:o}=t.data;o&&this.$emit("emit-get"),this.$httpMsgState(t.data,"刪除")}catch(e){this.$swal.fire({icon:"error",title:e})}}}},g=o("d959"),E=o.n(g);const f=E()(V,[["render",j]]);t["a"]=f}}]);
//# sourceMappingURL=chunk-6402758c.0d66d31a.js.map
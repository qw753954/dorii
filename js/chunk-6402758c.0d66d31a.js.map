{"version":3,"sources":["webpack:///./src/views/backend/Coupons.vue","webpack:///./src/components/backend/CouponModal.vue","webpack:///./src/components/backend/CouponModal.vue?8507","webpack:///./src/views/backend/Coupons.vue?8bd4","webpack:///./src/components/backend/DelModal.vue","webpack:///./src/components/backend/DelModal.vue?4e33"],"names":["_createElementVNode","class","_hoisted_1","width","_hoisted_18","_hoisted_21","_createVNode","_component_Loading","active","$data","isLoading","z-index","loader","type","onClick","_cache","$event","$options","openModal","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_createElementBlock","_Fragment","_renderList","coupons","item","key","id","_toDisplayString","title","code","percent","_ctx","$toLocalDate","due_date","_hoisted_12","checked","is_enabled","true-value","false-value","onChange","updateCoupon","for","_hoisted_15","_hoisted_16","_component_CouponModal","ref","is-new","isNew","temp-coupon","tempCoupon","onEmitUpdate","_component_DelModal","topic","tempData","onEmitChange","triggerLoading","onEmitGet","getCoupons","tabindex","aria-labelledby","aria-hidden","data-bs-dismiss","aria-label","_hoisted_2","$props","placeholder","coupon","content","_hoisted_13","_hoisted_14","dueDate","_hoisted_17","min","max","_hoisted_19","_hoisted_20","args","trigger","data","modal","mixins","modalMixins","props","Boolean","Object","emits","emit-update","obj","console","warn","methods","isPassValidate","this","success","message","$httpMsgState","$emit","watch","beforeOneDay","Date","toISOString","split","join","Math","floor","__exports__","name","inheritAttrs","pagination","components","CouponModal","DelModal","page","url","res","$get","err","$swal","fire","icon","httpsMethod","axios","then","$refs","couponModal","hideModal","catch","now","JSON","parse","stringify","delModal","render","isAll","delData","String","emit-get","$delete"],"mappings":"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","file":"js/chunk-6402758c.0d66d31a.js","sourcesContent":["<template>\n  <Loading :active=\"isLoading\" :z-index=\"1061\" loader=\"bars\"/>\n  <button\n    type=\"button\"\n    class=\"add-fixed rounded-circle shadow d-md-none\"\n    @click=\"openModal('new')\"\n  >\n    <i class=\"far fa-plus\"></i>\n  </button>\n  <div class=\"row\">\n    <div class=\"col-md-11 mx-auto\">\n      <div class=\"d-md-flex justify-content-between align-items-center mb-4\">\n        <h2 class=\"text-center fs-4 mb-0\">優惠券管理</h2>\n        <button\n          type=\"button\"\n          class=\"btn btn-secondary text-white d-none d-md-block\"\n          @click=\"openModal('new')\"\n        >\n          新增優惠券\n        </button>\n      </div>\n      <div class=\"card shadow rounded-4\">\n        <div class=\"card-body\">\n          <div class=\"table-responsive\">\n            <table class=\"table table-hover align-middle\">\n              <thead>\n                <tr class=\"bg-white sticky-top\">\n                  <th width=\"160\">名稱</th>\n                  <th width=\"160\">折扣碼</th>\n                  <th width=\"100\">折扣百分比</th>\n                  <th width=\"100\">到期日</th>\n                  <th width=\"80\" class=\"text-center\">是否啟用</th>\n                  <th width=\"150\"></th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr v-for=\"item in coupons\" :key=\"item.id\">\n                  <td>{{ item.title }}</td>\n                  <td>{{ item.code }}</td>\n                  <td>{{ item.percent }}%</td>\n                  <!-- 變日期格式，扣一天 ↓ -->\n                  <td>{{ $toLocalDate(item.due_date - 86400) }}</td>\n                  <td>\n                    <div class=\"d-flex justify-content-center switch-container\">\n                      <input\n                        type=\"checkbox\"\n                        class=\"scroll-input\"\n                        :id=\"item.id\"\n                        :checked=\"item.is_enabled\"\n                        :true-value=\"1\"\n                        :false-value=\"0\"\n                        v-model=\"item.is_enabled\"\n                        @change=\"updateCoupon(false, item)\"\n                      >\n                      <label :for=\"item.id\" class=\"scroll-label\"></label>\n                    </div>\n                  </td>\n                  <td class=\"text-end\">\n                    <div class=\"btn-group\">\n                      <button\n                        type=\"button\"\n                        class=\"operate-btn btn btn-outline-secondary btn-sm\"\n                        @click=\"openModal('edit', item)\"\n                      >\n                        <i class=\"fas fa-edit fa-fw\"></i>\n                      </button>\n                      <button\n                        type=\"button\"\n                        class=\"operate-btn btn btn-outline-danger btn-sm\"\n                        @click=\"openModal('delete', item)\"\n                      >\n                        <i class=\"fas fa-trash-alt fa-fw\"></i>\n                      </button>\n                    </div>\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <CouponModal\n    ref=\"couponModal\"\n    :is-new=\"isNew\"\n    :temp-coupon=\"tempCoupon\"\n    @emit-update=\"updateCoupon\"\n  />\n\n  <DelModal\n    ref=\"delModal\"\n    topic=\"coupon\"\n    :tempData=\"tempCoupon\"\n    @emit-change=\"triggerLoading\"\n    @emit-get=\"getCoupons\"\n  />\n</template>\n\n<script>\nimport CouponModal from '@/components/backend/CouponModal.vue';\nimport DelModal from '@/components/backend/DelModal.vue';\n\nimport { $get } from '@/assets/javascript/fetchAPI';\n\nexport default {\n  name: 'Coupons Management',\n  inheritAttrs: false,\n  data() {\n    return {\n      coupons: [],\n      pagination: {},\n      tempCoupon: {},\n      isNew: true,\n      isLoading: true,\n    };\n  },\n  components: {\n    CouponModal,\n    DelModal,\n  },\n  methods: {\n    async getCoupons(page = 1) {\n      try {\n        const url = `${process.env.VUE_APP_URL}/api/${process.env.VUE_APP_PATH}/admin/coupons?page=${page}`;\n        const res = await $get(url);\n        const { success, coupons, pagination } = res.data;\n        if (success) {\n          this.coupons = coupons;\n          this.pagination = pagination;\n        }\n        this.triggerLoading(false);\n      } catch (err) {\n        this.$swal.fire({ icon: 'error', title: err.message });\n      }\n    },\n    updateCoupon(isNew, item) {\n      this.triggerLoading(true);\n\n      let url;\n      let httpsMethod;\n      if (isNew) {\n        url = `${process.env.VUE_APP_URL}/api/${process.env.VUE_APP_PATH}/admin/coupon`;\n        httpsMethod = 'post';\n      } else {\n        url = `${process.env.VUE_APP_URL}/api/${process.env.VUE_APP_PATH}/admin/coupon/${item.id}`;\n        httpsMethod = 'put';\n      }\n      this.axios[httpsMethod](url, { data: item })\n        .then((res) => {\n          if (res.data.success) {\n            this.$refs.couponModal.hideModal();\n            this.getCoupons();\n          } else {\n            this.triggerLoading(false);\n          }\n          this.$httpMsgState(res.data, isNew ? '新增' : '更新');\n        })\n        .catch((err) => {\n          this.$swal.fire({ icon: 'error', title: err.message });\n        });\n    },\n    openModal(type, item) {\n      switch (type) {\n        case 'new':\n          this.isNew = true;\n          this.tempCoupon = {\n            due_date: Math.floor(Date.now() / 1000), // 預設會是當天日期\n          };\n          this.$refs.couponModal.openModal();\n          break;\n        case 'edit':\n          this.isNew = false;\n          this.tempCoupon = JSON.parse(JSON.stringify(item));\n          this.$refs.couponModal.openModal();\n          break;\n        case 'delete':\n          this.tempCoupon = { ...item };\n          this.$refs.delModal.openModal();\n          break;\n        default:\n          break;\n      }\n    },\n    triggerLoading(item) {\n      this.isLoading = item;\n    },\n  },\n  async created() {\n    await this.getCoupons();\n  },\n};\n</script>\n","<template>\n  <div\n    class=\"modal fade\"\n    tabindex=\"-1\"\n    aria-labelledby=\"exampleModalLabel\"\n    aria-hidden=\"true\"\n    ref=\"modal\"\n  >\n    <div class=\"modal-dialog modal-dialog-scrollable\">\n      <div class=\"modal-content\">\n\n        <div class=\"modal-header bg-primary\">\n          <h5 class=\"modal-title text-white\" id=\"exampleModalLabel\">\n            {{ isNew ? '新增優惠券' : '編輯優惠券' }}\n          </h5>\n          <button\n            type=\"button\"\n            class=\"btn-close btn-close-white\"\n            data-bs-dismiss=\"modal\"\n            aria-label=\"Close\"\n          >\n          </button>\n        </div>\n\n        <div class=\"modal-body\">\n          <div class=\"mb-3\">\n            <label for=\"title\" class=\"form-label\">標題<span class=\"text-danger\">*</span></label>\n            <input\n              type=\"text\"\n              class=\"form-control\"\n              id=\"title\"\n              placeholder=\"請輸入標題\"\n              v-model.trim=\"coupon.title\"\n            >\n          </div>\n          <div class=\"mb-3\">\n            <label for=\"content\" class=\"form-label\">詳述<span class=\"text-danger\">*</span></label>\n            <input\n              type=\"text\"\n              class=\"form-control\"\n              id=\"content\"\n              placeholder=\"請輸入詳述\"\n              v-model.trim=\"coupon.content\"\n            >\n          </div>\n          <div class=\"mb-3\">\n            <label for=\"code\" class=\"form-label\">優惠碼<span class=\"text-danger\">*</span></label>\n            <input\n              type=\"text\"\n              class=\"form-control\"\n              id=\"code\"\n              placeholder=\"請輸入優惠碼\"\n              v-model.trim=\"coupon.code\"\n            >\n          </div>\n          <div class=\"mb-3\">\n            <label for=\"date\" class=\"form-label\">到期日<span class=\"text-danger\">*</span></label>\n            <input\n              type=\"date\"\n              class=\"form-control\"\n              id=\"date\"\n              v-model=\"dueDate\"\n            >\n          </div>\n          <div class=\"mb-3\">\n            <label for=\"percent\" class=\"form-label\">\n              折扣百分比<span class=\"text-danger\">*</span>\n            </label>\n            <input\n              type=\"number\"\n              class=\"form-control\"\n              id=\"percent\"\n              placeholder=\"請輸入百分比\"\n              min=\"0\"\n              max=\"99\"\n              v-model.number=\"coupon.percent\"\n            >\n          </div>\n        </div>\n\n        <div class=\"modal-footer\">\n          <div class=\"form-check me-auto\" v-if=\"isNew\">\n            <input\n              class=\"form-check-input\"\n              type=\"checkbox\"\n              id=\"is_enabled\"\n              :true-value=\"1\"\n              :false-value=\"0\"\n              v-model=\"coupon.is_enabled\"\n            >\n            <label\n              for=\"is_enabled\"\n              class=\"form-check-label align-middle\"\n            >\n              是否啟用\n            </label>\n          </div>\n          <button type=\"button\" class=\"btn btn-outline-gray btn-sm\" data-bs-dismiss=\"modal\">\n            取消\n          </button>\n\n          <button\n            type=\"button\"\n            class=\"btn btn-primary btn-sm\"\n            @click=\"trigger\"\n          >\n            確認\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport modalMixins from '@/mixins/modalMixins';\n\nexport default {\n  data() {\n    return {\n      modal: '',\n      coupon: {},\n      dueDate: '',\n    };\n  },\n  mixins: [modalMixins],\n  props: {\n    isNew: Boolean,\n    tempCoupon: Object,\n  },\n  emits: {\n    'emit-update': (isNew, obj) => {\n      if (typeof isNew !== 'boolean') {\n        console.warn('emit-update 事件的第一個參數型別需為 boolean');\n      } else if (typeof obj !== 'object') {\n        console.warn('emit-update 事件的第二個參數型別需為 object');\n      }\n      return typeof isNew !== 'boolean' && obj !== 'object';\n    },\n  },\n  methods: {\n    trigger() {\n      let isPassValidate = true;\n\n      if (!this.coupon.title || !this.coupon.content || !this.coupon.due_date || !this.coupon.code\n      || this.coupon.percent === '') {\n        const data = {\n          success: false,\n          message: '所有欄位都要填寫',\n        };\n        this.$httpMsgState(data, this.isNew ? '新增' : '更新');\n\n        isPassValidate = false;\n      }\n\n      if (this.coupon.percent > 99) {\n        const data = {\n          success: false,\n          message: '折扣百分比不能高於 99',\n        };\n        this.$httpMsgState(data, this.isNew ? '新增' : '更新');\n\n        isPassValidate = false;\n      }\n\n      if (this.coupon.percent < 0) {\n        const data = {\n          success: false,\n          message: '折扣百分比不能低於 0',\n        };\n        this.$httpMsgState(data, this.isNew ? '新增' : '更新');\n\n        isPassValidate = false;\n      }\n\n      if (isPassValidate) {\n        this.$emit('emit-update', this.isNew, this.coupon);\n      }\n    },\n  },\n  watch: {\n    tempCoupon() {\n      this.coupon = { ...this.tempCoupon };\n\n      if (this.isNew) {\n        this.coupon.is_enabled = 0;\n      }\n\n      // 後端收到的是 [到期日的隔天]（因為到期當天還是可順利套用 coupon）\n      // 但 Modal 是要呈現 [到期當天]，所以要再 \"扣一天\"\n      const beforeOneDay = this.coupon.due_date * 1000 - 86400;\n      // 轉換成 type=\"date\" 會吃的格式  ex: 2021-06-19\n      this.dueDate = new Date(beforeOneDay).toISOString().split('T', 1).join();\n    },\n    dueDate() {\n      // 後端是收 Timestamp\n      // [到期日當天] 也需可以套用優惠券，所以送給後端時要再 \"加一天\"\n      this.coupon.due_date = Math.floor(new Date(this.dueDate) / 1000 + 86400);\n    },\n  },\n};\n</script>\n","import { render } from \"./CouponModal.vue?vue&type=template&id=41b717ae\"\nimport script from \"./CouponModal.vue?vue&type=script&lang=js\"\nexport * from \"./CouponModal.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/Users/ksyobo_/vue-dorii/node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","import { render } from \"./Coupons.vue?vue&type=template&id=31bb5204\"\nimport script from \"./Coupons.vue?vue&type=script&lang=js\"\nexport * from \"./Coupons.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/Users/ksyobo_/vue-dorii/node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","<template>\n  <div\n    class=\"modal fade\"\n    tabindex=\"-1\"\n    aria-labelledby=\"exampleModalLabel\"\n    aria-hidden=\"true\"\n    ref=\"modal\"\n  >\n    <div class=\"modal-dialog modal-dialog-centered\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header bg-danger\">\n          <h5 class=\"modal-title text-white\" id=\"exampleModalLabel\">\n            刪除\n          </h5>\n          <button type=\"button\"\n            class=\"btn-close btn-close-white\"\n            data-bs-dismiss=\"modal\"\n            aria-label=\"Close\"\n          >\n          </button>\n        </div>\n        <div class=\"modal-body\">\n          確定要刪除\n          <template v-if=\"topic === 'product'\">\n            <span class=\"fw-bold text-danger\">{{ tempData.title }}</span> 商品嗎？\n          </template>\n          <template v-else-if=\"isAll\">\n            <span class=\"fw-bold text-danger\">所有訂單</span> ？\n          </template>\n          <template v-else-if=\"topic === 'order'\">\n            <span class=\"fw-bold text-danger\">編號 {{ tempData.id }}</span> 訂單？\n          </template>\n          <template v-else-if=\"topic === 'article'\">\n            <span class=\"fw-bold text-danger\">{{ tempData.title }}</span> 文章嗎？\n          </template>\n          <template v-else>\n            <span class=\"fw-bold text-danger\">{{ tempData.title }}</span> 優惠券嗎？\n          </template>\n          刪除後無法恢復！\n        </div>\n        <div class=\"modal-footer\">\n          <button\n            type=\"button\"\n            class=\"btn btn-outline-gray btn-sm\"\n            data-bs-dismiss=\"modal\"\n          >\n            關閉\n          </button>\n          <button\n            type=\"button\"\n            class=\"btn btn-danger btn-sm\"\n            @click=\"delData\"\n          >\n            確定\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport modalMixins from '@/mixins/modalMixins';\n\nimport { $delete } from '@/assets/javascript/fetchAPI';\n\nexport default {\n  data() {\n    return {\n      modal: null,\n    };\n  },\n  mixins: [modalMixins],\n  props: {\n    tempData: Object,\n    topic: String,\n    isAll: Boolean,\n  },\n  emits: {\n    'emit-change': (item) => {\n      if (typeof item !== 'boolean') {\n        console.warn('emit-change 事件的參數型別需為 boolean');\n      }\n      return typeof item !== 'boolean';\n    },\n    'emit-get': () => true,\n  },\n  methods: {\n    // 刪除商品、文章、優惠券、全部及單一訂單\n    async delData() {\n      // 讓頁面先顯示 loading & 關閉 Modal\n      this.$emit('emit-change', true);\n      this.hideModal();\n\n      try {\n        const url = `${process.env.VUE_APP_URL}/api/${process.env.VUE_APP_PATH}/admin/${this.isAll ? 'orders/all' : `${this.topic}/${this.tempData.id}`}`;\n        const res = await $delete(url);\n        const { success } = res.data;\n        if (success) this.$emit('emit-get');\n        this.$httpMsgState(res.data, '刪除');\n      } catch (err) {\n        this.$swal.fire({ icon: 'error', title: err });\n      }\n    },\n  },\n};\n</script>\n","import { render } from \"./DelModal.vue?vue&type=template&id=2ccb2b99\"\nimport script from \"./DelModal.vue?vue&type=script&lang=js\"\nexport * from \"./DelModal.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/Users/ksyobo_/vue-dorii/node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"sourceRoot":""}